%script#template-download{:type => 'html/template'}
  {% for (var i=0, file; file=o.files[i]; i++) { %}
  .panel.panel-default.template-download
    #headingOne.panel-heading{:role => "tab"}
      %strong.error.text-danger {%= file.error %}
      %table.document{:style => "width:100%"}(data-formatted_creation_date = "{%= file.formatted_creation_date %}" data-formatted_filesize = "{%= file.formatted_filesize %}" data-id = "{%= file.id %}" data-formatted_modification_date = "{%= file.formatted_modification_date %}" data-original_filename = "{%= file.original_filename %}" data-original_type = "{%= file. original_type %}" data-revision = "{%= file.revision %}" data-document_group_id = "{%= file.document_group_id %}")
        %tr
          %td.title{:width => '340px'}
            %div{:'data-toggle' => 'edit'}
              .fade.edit
                %input.title{:'data-name' => :title, :'value' => "{%= file.title %}"}
              .fade.no_edit
                %span {%= file.title %}
          %td.revision{:'data-name' => 'revision', :width => '58px'}
            %div{:'data-toggle' => 'edit'}
              .fade.edit
                %input.revision{:'data-name' => :revision, :'value' => "{%= file.revision %}", :style => 'width:40px'}
              .fade.no_edit
                -# height required to properly position the tag
                %div{:style => "width:30px; height:26px;"} {%= file.revision %}
          -# make sure it's on top of the next td, even though it precedes in the html
          %td.include_popover
            %div{:'data-toggle' => 'edit'}
              .fade.edit
                %i.glyphicon.glyphicon-remove#edit_cancel
              .fade.no_edit
                %i.glyphicon.glyphicon-info-sign.details <!-- popover is attached as a sibling below this -->
          %td.under_popover
            %div{:'data-toggle' => 'edit'}
              .fade.edit
                %i.glyphicon.glyphicon-ok
              .fade.no_edit
                %i.glyphicon.glyphicon-edit#edit_start
          %td.under_popover
            %i.glyphicon.glyphicon-cloud-download.download
          %td.under_popover
            %div{:'data-toggle' => "collapse", :'data-parent' => "#accordion", :href => "#collapse{%= file.id %}"}
              %i.fa.fa-archive
          %td.under_popover
            -# next tag is where the fileupload is attached
            .file_replace{:id => "upload{%= file.id %}"}
              %i.fa.fa-plus{:onClick => "$(this).parent().find('input:file').click()"}
              -# wierd opacity and width ensures that firefox recognizes element as visible and capybara-webkit can interact!
              -# only required for testing, it actually works in firefox in real life!
              %input#archive_fileinput{:multiple => "multiple", :name => "replace_file", :type => "file", :style => "position:absolute; top:0px; left:400px; opacity:0.01; width:0.01px;"}
          %td
            %div.delete{:data=> {:url => "{%= file.deleteUrl %}"}}
              %i.glyphicon.glyphicon-trash
    .panel-collapse.collapse{:role => "tabpanel", :id => "collapse{%= file.id %}"}
      .panel-body
        %h4 Archive
        {% if ((typeof(file.archive_files)!='undefined' && (file.archive_files.length == 0)) || typeof(file.archive_files)=='undefined') { %}
        %p empty
        {% } else { %}
        {% for (var j=0, archive_file; archive_file=file.archive_files[j]; j++) { %}
        %table.document{:style => "width:100%"}(data-formatted_creation_date = "{%= archive_file.formatted_creation_date %}" data-formatted_filesize = "{%= archive_file.formatted_filesize %}" data-id = "{%= archive_file.id %}" data-formatted_modification_date = "{%= archive_file.formatted_modification_date %}" data-original_filename = "{%= archive_file.original_filename %}" data-original_type = "{%= archive_file. original_type %}" data-revision = "{%= archive_file.revision %}")
          %tr
            %td.title{:width => '340px'}
              %div{:'data-toggle' => 'edit'}
                .fade.edit
                  %input.title{:'data-name' => :title, :'value' => "{%= archive_file.title %}"}
                .fade.no_edit
                  %span {%= archive_file.title %}
            %td.revision{:'data-name' => 'revision', :width => '58px'}
              %div{:'data-toggle' => 'edit'}
                .fade.edit
                  %input.revision{:'data-name' => :revision, :'value' => "{%= archive_file.revision %}", :style => 'width:40px'}
                .fade.no_edit
                  -# height required to properly position the tag
                  %div{:style => "width:30px; height:26px;"} {%= archive_file.revision %}
            -# make sure it's on top of the next td, even though it precedes in the html
            %td.include_popover
              %div{:'data-toggle' => 'edit'}
                .fade.edit
                  %i.glyphicon.glyphicon-remove#edit_cancel
                .fade.no_edit
                  %i.glyphicon.glyphicon-info-sign.details <!-- popover is attached as a sibling below this -->
            %td.under_popover
              %div{:'data-toggle' => 'edit'}
                .fade.edit
                  %i.glyphicon.glyphicon-ok
                .fade.no_edit
                  %i.glyphicon.glyphicon-edit#edit_start
            %td.under_popover
              %i.glyphicon.glyphicon-cloud-download.download
            %td.under_popover
              -# just to keep the spacing the same
              %div{:style => 'visibility:hidden'}
                %i.fa.fa-archive
            %td.under_popover
              -# just to keep the spacing the same
              #file_replace{:style => 'visibility:hidden'}
                %i.fa.fa-plus
            %td
              %div.delete{:data=> {:url => "{%= archive_file.deleteUrl %}"}}
                %i.glyphicon.glyphicon-trash
        {% }} %}
  {% } %}
