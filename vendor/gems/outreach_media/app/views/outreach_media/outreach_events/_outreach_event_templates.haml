%script#outreach_event_documents_template{:type => 'template/ractive'}
  .col-md-6#outreach_event_documents{:style=>"display:flex; flex-direction: column"}
    {{#outreach_event_documents}}
    <outreachEventDocument file_content_type={{file_content_type}} file_filename={{file_filename}} file_size={{file_size}} name={{name}} id={{id}} outreach_event_id={{outreach_event_id}} url={{url}} file_id={{file_id}} />
    {{/}}

%script#outreach_event_document_template{:type => 'template/ractive'}
  .row
    .col-md-8.col-md-offset-1
      .outreach_event_document#selected_file {{ file_filename }}
    .col-md-1
      %i.fa.fa-remove.fa-lg#deselect_file{:style =>'vertical-align:0px', 'on-click'=>'deselect_file()'}
    .col-md-1
      {{#if persisted }}
      %i.fa.fa-cloud-download{'on-click' => 'download_attachment()'}
      {{/if}}
  .row
    .col-md-12.col-md-offset-1
      .form-group{:class => "{{#file_size_error}}has-error{{/}}"}
        %span.help-block#file_size_error{:style => "font-size:0.8em; padding-left:4px; position:relative; top:-4px; width:100%; background-color:#d9d0a5"}= t('.too_large')
      .form-group{:class => "{{#file_content_type_error}}has-error{{/}}"}
        %span.help-block#file_content_type_error{:style => "font-size:0.8em; padding-left:4px; position:relative; top:-4px; width:100%; background-color:#d9d0a5"}= t('.unpermitted_type')

%script#outreach_events_template{:type => 'template/ractive'}
  .row
    .btn.btn-success.btn-sm#add_outreach_event{:style => "margin-bottom:12px; color:white;", :onclick => "outreach.new_article()"}
      %i.fa.fa-plus.fa-lg{:style => "color:white"}
      %span= t('.add_outreach')
    %input.hidden_fileinput#outreach_event_file{:multiple => "multiple", :type => "file", :decorator => :ractive_fileupload }
  .row.filter_control_box#outreach_events_controls
    .row
      .col-md-4
        %h4= t('.search_heading')
    .row.labels
      .col-md-2= t('.title')
      .col-md-2= t('.from')
      .col-md-2= t('.to')
      .col-md-2
        =t('.area')
        \/
        =t('.subarea')
    .row{:style => "margin-bottom:12px;"}
      .col-md-2
        %input.form-control#title{:type => :text, :name => :title, :placeholder => t('.enter_title_text'), :value => "{{filter_criteria.title}}"}
      .col-md-2
        %input.form-control#from{:type=>"text", :name=>"from", :placeholder => t('.from_date'), :value => "{{formatted_from_date}}"}
      .col-md-2
        %input.form-control#to{:type=>"text", :name=>"to", :placeholder => t('.to_date'), :value => "{{formatted_to_date}}"}
      .col-md-3
        .btn-group.select
          %button.btn.btn-default.dropdown-toggle{:type=>:button, 'data-toggle'=>'dropdown'}
            %span.filter-option.pull-left= t('.select_area')
            %span.caret
          %ul.dropdown-menu
            %li.filter_rule
              %a{'on-click'=>"filter_rule('all')", :class => "{{#if filter_criteria.rule == 'all'}}selected{{/if}}"}
                %span=t('.all')
                %span.fa.fa-check
              %a{'on-click'=>"filter_rule('any')", :class => "{{#if filter_criteria.rule == 'any'}}selected{{/if}}"}
                %span=t('.any')
                %span.fa.fa-check
            {{#areas}}
            <area id='{{id}}' name='{{name}}'/>
            {{/areas}}
      .col-md-1
        %i.erase.fa.fa-refresh{'on-click'=>'clear_filter()', 'data-toggle'=>'tooltip', 'title' => t('.clear')}
      .col-md-1
        {{#if expanded}}
        %a#compact{'on-click'=>'compact()', 'data-toggle'=>'tooltip', 'title'=>t('.compact_all')}
        {{else}}
        %a#expand{'on-click'=>'expand()', 'data-toggle'=>'tooltip', 'title'=>t('.expand_all')}
        {{/if}}
    .row.labels
      .col-md-2= t('.people_affected')
      .col-md-2= t('.participant_count')
      .col-md-2= t('.audience_type')
      .col-md-2= t('.audience_name')
    .row.labels
      .col-md-1= t('.min')
      .col-md-1= t('.max')
      .col-md-1= t('.min')
      .col-md-1= t('.max')
    .row
      .col-md-1.filter_field.pa_min
        %input.form-control{:style=>"width:72px", :value => '{{filter_criteria.pa_min}}'}
        %span.error_message= t('defaults.invalid')
      .col-md-1.filter_field.pa_max
        %input.form-control{:style=>"width:72px", :value => '{{filter_criteria.pa_max}}'}
        %span.error_message= t('defaults.invalid')
      .col-md-1.filter_field.pp_min
        %input.form-control{:style=>"width:72px", :value => '{{filter_criteria.pp_min}}'}
        %span.error_message= t('defaults.invalid')
      .col-md-1.filter_field.pp_max
        %input.form-control{:style=>"width:72px", :value => '{{filter_criteria.pp_max}}'}
        %span.error_message= t('defaults.invalid')
      .col-md-2
        .btn-group.audience_type-select.select{:style => "width:170px;"}
          %button.btn.btn-default.dropdown-toggle{:type=>:button, 'data-toggle'=>'dropdown'}
            %span.filter-option.pull-left {{ selected_audience_type }}
            %span.caret
          %ul.dropdown-menu
            {{#audience_types}}
            <at id='{{id}}' text='{{text}}' long_type='{{long_type}}' short_type='{{short_type}}'/>
            {{/audience_types}}
      .col-md-1.filter_field.audience_name
        %input.audience_name.form-control{:style=>"width:200px", :value => '{{filter_criteria.audience_name}}', :placeholder => t('.enter_audience_name')}
    .row.labels{:style => "margin-top: 12px; margin-bottom:8px;"}
      .col-md-4= t('.impact')
    .row
      .col-md-4
        .btn-group.impact_rating-select.select{:style => "width:390px;"}
          %button.btn.btn-default.dropdown-toggle{:type=>:button, 'data-toggle'=>'dropdown'}
            %span.filter-option.pull-left {{ selected_impact_rating }}
            %span.caret
          %ul.dropdown-menu
            {{#impact_ratings}}
            <ir id='{{id}}' rank_text='{{rank_text}}' />
            {{/impact_ratings}}
  #outreach_event_list
    {{#outreach_events}}
    <oe affected_people_count='{{affected_people_count}}' area_ids='{{area_ids}}' areas='{{areas}}' audience_name='{{audience_name}}' audience_type_id='{{audience_type_id}}' create_note_url='{{create_note_url}}' create_reminder_url='{{create_reminder_url}}' date='{{date}}' description='{{description}}' description_error='{{description_error}}' expanded='false' id='{{id}}' impact_rating_id='{{impact_rating_id}}' media_areas='{{media_areas}}' notes='{{notes}}' outreach_event_areas='{{outreach_event_areas}}' outreach_event_documents='{{outreach_event_documents}}' outreach_event_error='{{outreach_event_error}}' participant_count='{{participant_count}}' performance_indicator_associations='{{performance_indicator_associations}}' on-edit='edit' reminders='{{reminders}}' subarea_ids='{{subarea_ids}}' title='{{title}}' title_error='false' url='{{url}}'/>
    {{/outreach_events}}

%script#outreach_event_template{:type => 'template/ractive'}
  {{#if persisted }}
  {{> show_outreach_event_template }}
  {{else}}
  {{> new_outreach_event_template }}
  {{/if}}

%script#show_outreach_event_template{:type => 'template/ractive'}
  .row.outreach_event.well.well-sm.editable_container{:style => "{{#if !include}}display:none{{/if}}", :decorator => 'inpage_edit:{{id}}'}
    .col-md-12
      .row.basic_info
        .col-md-2.date{:style => "width:15%", 'data-toggle'=>:edit}
          .fade.no_edit.in {{formatted_date}}
          .fade.edit{:style => 'padding-top:20px;'}
            %input.form-control#event_date{:type => :text, :decorator => 'datepicker', :value => '{{formatted_date}}', :style => 'height:33px;'}
        .col-md-2.title{'data-toggle'=>'edit', :style => "width:60%"}
          .fade.no_edit.in
            %span {{ title }}
          .fade.edit{:style => "width: 100%"}
            {{> edit_title}}
        .col-md-2.actions{:style => "width:25%"}
          .row{:style => "margin-left:0px;"}
            .col-md-1{'data-toggle'=>:edit}
              .no_edit.in
                .alarm_icon.counter{'data-count'=>"{{reminders_count}}", 'on-click' => "show_reminders_panel()", :style => "position:relative; top:2px; width:16px;"}
              .edit
            .col-md-1{'data-toggle'=>:edit}
              .no_edit.in
                %i.fa.fa-file-text-o.show_notes.counter{'data-count'=>'{{notes_count}}', 'on-click' => "show_notes_panel()", :style => "position:relative; left: -3px;"}
              .edit
            .col-md-1.icon{ 'data-toggle' => 'edit'}
              .fade.edit
                %i.fa.fa-remove{:id => "outreach_event_editable{{id}}_edit_cancel"}
            .col-md-1.icon{'data-toggle' => 'edit'}
              .fade.edit
                %i.fa.fa-check{:id => "outreach_event_editable{{id}}_edit_save"}
              .fade.no_edit.in
                %i.fa.fa-pencil-square-o{:id => "outreach_event_editable{{id}}_edit_start", :style=> "position:relative; top:1px;"}
            .col-md-1{'data-toggle' => :edit}
              .fade.no_edit.in
                %i.fa.fa-sm.fa-trash-o.delete_icon{'on-click'=>'show_confirm_delete_modal()'}
              .fade.edit
            .col-md-1{'data-toggle'=>:collapse, :href => ".collapse{{id}}", :style => "width:45px;"}
              %div{'data-toggle' => :edit}
                .fade.no_edit.in
                  {{#if expanded}}
                  %i#compact{'on-click'=>'compact()', 'data-toggle'=>'tooltip', 'title'=>t('.compact'), :style => "position:relative; top:3px;"}
                  {{else}}
                  %i#expand{'on-click'=>'expand()', 'data-toggle'=>'tooltip', 'title'=>t('.expand'), :style => "position:relative; top:3px;"}
                  {{/if}}
                .fade.edit
      .row.fileupload{'data-toggle'=>:edit}
        .fade.no_edit.in
        .fade.edit
          .col-md-1
            %span.btn.btn-xs.btn-success.fileinput-button{:decorator=>"file_select_trigger"}
              %i.fa.fa-plus.fa-lg{ :style => "color:white"}
              %span{:style=>"margin-left:6px;"}= t('add_file')
      .collapse.expanded_info{:class => "collapse{{id}}"}
        .panel.panel-default
          .panel-heading= t('.files')
          .panel-body{:style => "padding:0px"}
            <outreachEventDocuments outreach_event_documents={{outreach_event_documents}} />
        <performanceindicatorselect />
        .panel.panel-default
          .panel-heading
            .row
              .col-md-2.description{:style => "width:50%"}
                =t('.areas')
                \/
                =t('.subareas')
              .col-md-2.metrics{:style=>"width:25%;"}= t('.metrics')
          .panel-body{'data-toggle'=>'edit'}
            .fade.no_edit.in
              .row
                .col-md-2.description{:style => "width:50%"}
                  {{#outreach_event_areas}}
                  <outreacharea/>
                  {{/outreach_event_areas}}
                .col-md-2.metrics{:style=>"width:40%; display:flex; flex-direction:column;"}
                  .metric#affected_people_count
                    .name= t('activerecord.attributes.outreach_event.affected_people_count')
                    .value {{ formatted_affected_people_count }}
                  .metric#audience_type
                    .name= t('activerecord.models.audience_type')
                    .value {{ audience_type_text }}
                  .metric#audience_name
                    .name= t('activerecord.attributes.outreach_event.audience_name')
                    .value {{ audience_name }}
                  .metric#description
                    .name= t('activerecord.attributes.outreach_event.description')
                    .value {{ description }}
                  .metric#participant_count
                    .name= t('activerecord.attributes.outreach_event.participant_count')
                    .value {{ formatted_participant_count }}
                  .metric#impact_rating
                    .name= t('activerecord.models.impact_rating')
                    .value {{ impact_rating_text }}
            .fade.edit
              {{> outreach_event_edit}}

%script#new_outreach_event_template{:type => 'template/ractive'}
  .row.outreach_event.well.well-sm.form.fileupload
    .col-md-12
      .row
        .col-md-1{:style => "padding-top:28px; width: 108px"}= t('.title')
        .col-md-8
          {{> edit_title }}
        .col-md-2
          .form-group
            .nothing{:style => 'visibility:hidden'} nothing
            %i.fa.fa-remove.fa-lg#edit_cancel{:style => 'padding-left:30px', 'on-click'=>'cancel()'}
            %i.fa.fa-check.fa-lg#edit-save{:style => 'padding-left:30px', 'on-click'=>'save()'}
      .row
        .col-md-1{:style => "width:108px; padding-top:4px"}= t('.date')
        .col-md-2
          %input.form-control#event_date{:type => :text, :decorator => 'datepicker', :value => '{{formatted_date}}'}

      .row.fileupload-buttonbar
        .col-lg-9#fileinput_button
          %span.btn.btn-success.btn-xs{:decorator=>"file_select_trigger"}
            %i.fa.fa-plus.fa-lg{ :style => "color:white"}
            {{#if no_files_chosen }}
            %span{:style=>"margin-left:6px;"}= t('add_file')
            {{else}}
            %span{:style=>"margin-left:6px;"}= t('add_another_file')
            {{/if}}
      .row
        <outreachEventDocuments outreach_event_documents={{outreach_event_documents}} />

      <performanceindicatorselect />
      .row.form-group{:class => "{{#outreach_event_error}}has-error{{/}}", :style => "padding-bottom:0px"}
        .col-md-2
          %span.help-block#outreach_event_error{:style => "font-size:0.8em; padding-left:4px; position:relative; top:-4px; width:100%; background-color:#d9d0a5"}= t('.outreach_event_error_message')
      .row.form-group{:class => "{{#outreach_event_double_attachment_error}}has-error{{/}}", :style => "margin-bottom:0px"}
        .col-md-2
          %span.help-block#outreach_event_attachment_error{:style => "font-size:0.8em; padding-left:4px; position:relative; top:-4px; width:100%; background-color:#d9d0a5"}= t('.outreach_event_double_attachment_error_message')
      .panel.panel-default.expanded_info
        .panel-heading
          .row
            .col-md-2.description{:style => "width:50%"}
              =t('.areas')
              \/
              =t('.subareas')
            .col-md-2.metrics{:style=>"width:25%;"}= t('.metrics')
        .panel-content
          {{> outreach_event_edit}}

%script#outreach_event_edit{:type => 'text/ractive'}
  .row
    .col-md-2{:style => "width:50%"}
      {{#areas }}
      /* this component will work when the ractive bug is fixed and version 0.8 is stable */
      /* <area-select id='{{id}}' area_id='{{id}}' area_ids='{{area_ids}}' name='{{name}}' subareas='{{subareas}}'/> */
      .checkbox
        %label
          %input{:type=>:checkbox, :id => 'outreach_event_area_ids_{{id}}', :name => '{{area_ids}}', :value => '{{id}}'}
          {{ name }}
      {{#subareas }}
      .checkbox.subarea
        %label
          %input{:type=>:checkbox, 'on-change' => 'show_metrics(event.original,id)', :id => 'outreach_event_subarea_ids_{{id}}', :name => '{{subarea_ids}}', :value => '{{id}}'}
          {{ name }}
      {{/subareas }}
      {{/areas }}
    .col-md-2{:style => "width:50%"}
      .form-group.row#audience_type
        %label.control-label.col-md-2{:for => 'audience_type', :style => "width:40%"}= t('.audience_type')
        =select_tag "outreach_event[audience_type_id]", audience_type_options, :prompt => t('.select_at'), :class =>"form-control col-md-2", :id => "audience_type",  :style => "width:50%", :value => "{{audience_type_id}}"
      .form-group.row#audience_name
        %label.control-label.col-md-2{:for => 'outreach_event_audience_name', :style=>'width:40%'}= t('activerecord.attributes.outreach_event.audience_name')
        %input.form-control#audience_name.col-md-2{:type => :text, :name => "outreach_event[audience_name]", :value => "{{audience_name}}", :style => "width:50%"}
      .form-group.row#participant_count
        %label.control-label.col-md-2{:for => 'outreach_event_participant_count', :style=>'width:40%'}= t('activerecord.attributes.outreach_event.participant_count')
        %input.form-control#participant_count.col-md-2{:type => :text, :name => "outreach_event[participant_count]", :value => "{{participant_count}}", :style => "width:50%"}
      .form-group.row#description
        %label.control-label.col-md-2{:for => 'outreach_event_description', :style=>'width:40%'}= t('activerecord.attributes.outreach_event.description')
        %textarea.form-control#description.col-md-2{:name => "outreach_event[description]", :value => "{{description}}", :style => "width:50%"}
      .form-group.hr_metrics.row#people_affected{:style => '{{#unless hr_violation}}display:none{{/unless}}'}
        %label.control-label.col-md-2{:for => 'people_affected', :style => "width:40%"}= t('.num_people')
        %input.form-control#people_affected.col-md-2{:placeholder => t('.enter_num_val'), :name => "outreach_event[affected_people_count]", :style => "width:15%", :value => "{{affected_people_count}}"}
      .form-group.row#impact_rating
        %label.control-label.col-md-2{:for => 'impact_rating', :style => "width:40%"}= t('.impact_rating')
        =select_tag "outreach_event[impact_rating_id]", impact_rating_options, :prompt => t('.select_ir'), :class =>"form-control col-md-2", :id => "impact_rating",  :style => "width:50%", :value => "{{impact_rating_id}}"

%script#audience_type_template{:type => 'text/ractive'}
  %li{:class => 'audience_type {{#if audience_type_selected}}selected{{/if}}'}
    %a.opt{'on-click'=>'toggle()'}
      %span.text {{text}}
      %span.fa.fa-check

%script#impact_rating_option_template{:type => 'text/ractive'}
  %li{:class => 'impact_rating {{#if impact_rating_selected}}selected{{/if}}'}
    %a.opt{'on-click'=>'toggle()'}
      %span.text {{rank_text}}
      %span.fa.fa-check

