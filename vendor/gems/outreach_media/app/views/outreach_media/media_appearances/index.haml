= stylesheet_link_tag 'outreach_media'
= stylesheet_link_tag 'media_issues'
%h1= t('.heading')

.btn.btn-success.btn-sm.add_article{:style => "margin-bottom:12px; color:white;", :onclick => "collection.new_article()"}
  %i.fa.fa-plus.fa-lg{:style => "color:white"}
  %span= t('.add_article')

#collection_container

= render :partial => 'shared/confirm_delete_modal'
= render :partial => 'shared/performance_indicator_select'
= render :partial => 'shared/collection_filter_controls', :locals => {:collection => :media_appearances, :search_heading => t('.search_heading')}
= render :partial => 'shared/collection', :locals => {:item => :media_appearance, :i18n_key => "outreach_media.media_appearances.index"}
= render :partial => 'reminders/reminder' # it's in the main app
= render :partial => 'notes/note' # it's in the main app

:javascript
  var collection_items = #{@media_appearances.to_json}
  var item_name = "media_appearance"
  var areas = #{@areas.to_json}
  var subareas = #{@subareas.to_json}
  var new_collection_item = #{@media_appearance.to_json}
  var create_collection_item_url = "#{@media_appearance.create_url}"
  var maximum_filesize = #{OutreachEvent.maximum_filesize * 1000000}
  var permitted_filetypes = #{OutreachEvent.permitted_filetypes }
  var planned_results = #{@planned_results.to_json }
  var Collection = {}
  var delete_confirmation_message = "#{t('.delete_confirmation_message')}"

:coffeescript
  window.performance_indicators = _.chain(planned_results).
    map((pr)->pr.outcomes).
    flatten().
    map((pr)->pr.activities).
    flatten().
    map((a)->a.performance_indicators).
    flatten().
    map((a)->_(a).values()).
    object().
    value()

= javascript_include_tag "media"
