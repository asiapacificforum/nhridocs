= stylesheet_link_tag 'nhri/headings'
%h1{:style => "padding-bottom:24px"}= t('.indicators_heading', :title => @heading.title)
#reminder
#note
#monitor

#indicators
  .row.row-eq-height.grid_headings
    .col-md-1#corner{:style =>"width:104px;"}
      #high-right= t('.offence')
      #low-left= t('.nature')
    .col-md-11
      .row.row-eq-height
        - @heading.offences.each do |o|
          .col-md-2{:style => "width:#{100/@heading.offences.length}%"}= o.description
  - ["structural", "process", "outcomes"].each do |nature|
    = render :partial => "indicator_nature", :locals => {:nature => nature}

:coffeescript
  $ ->
  # position the labels in the corner box, it depends on column height
    window.position_labels = ->
      height = $('.row-eq-height').height()
      width = $('#corner').width()
      ll_vert_pos = (height/2) + (height-50)/3
      ll_right_pos = 51-(height-50)/8
      hr_left_pos = 44+(height-50)/44
      $('#low-left').css('top', ll_vert_pos+'px').css('right',ll_right_pos+'px').show()
      $('#high-right').css('bottom',height/2+'px').css('left',hr_left_pos+'px').show()
    position_labels()

%script#indicator_template{:type => 'template/ractive'}
  {{title}}
  %div{:style => "display:flex; flex-direction:row;"}
    %i.fa.fa-trash-o.fa-lg.delete_indicator{'on-click' => 'delete_indicator(event,this)', :style => "position:relative; top:4px;"}
    %i.fa.fa-eye.show_monitors.counter{'data-count'=>"{{monitors_count}}", 'on-click' => "show_monitors_panel()", :style => "position:relative; top:4px; margin-left:30px;"}
    .alarm_icon.counter{'data-count'=>"{{reminders_count}}", 'on-click' => "show_reminders_panel()", :style => "position:relative; top:3px; width:16px; margin-left:30px;"}
    %i.fa.fa-file-text-o.show_notes.counter{'data-count'=>"{{notes_count}}", 'on-click' => "show_notes_panel()", :style => "position:relative; top:4px; margin-left:30px;"}
    -#<reminders />
    <notes />
    <monitors />

= render :partial => 'reminders/reminder' # it's in the main app
= render :partial => 'notes/note' # it's in the main app
= render :partial => 'monitor'
= javascript_include_tag 'jquery_datepicker'

:coffeescript
  $ ->
    _($('.indicator')).each (i)->
      id = $(i).data('object').id || 'new'
      window["indicator"+id] = new Ractive
        el : i
        template : '#indicator_template'
        data :
          $(i).data('object')
        computed :
          monitors_count : ->
            @get('monitors').length
          reminders_count : ->
            @get('reminders').length
          notes_count : ->
            @get('notes').length
          create_reminder_url : ->
            "#{nhri_indicator_indicator_reminders_path('indicator_id')}".
              replace(/indicator_id/,@get('id'))
          create_note_url : ->
            "#{nhri_indicator_indicator_notes_path('indicator_id')}".
              replace(/indicator_id/,@get('id'))
          create_monitor_url : ->
            "#{nhri_indicator_indicator_monitors_path('indicator_id')}".
              replace(/indicator_id/,@get('id'))
        show_reminders_panel : ->
          reminders.set
            reminders: @get('reminders')
            create_reminder_url : @get('create_reminder_url')
          $('#reminders_modal').modal('show')
        show_notes_panel : ->
          #$(@find('#notes_modal')).modal('show')
          notes.set
            notes : @get('notes')
            create_note_url : @get('create_note_url')
          $('#notes_modal').modal('show')
        show_monitors_panel : ->
          #$(@find('#monitors_modal')).modal('show')
          monitors.set
            monitors : @get('monitors')
            create_monitor_url : @get('create_monitor_url')
          $('#monitors_modal').modal('show')
        delete_indicator : (event,obj)->
          data = [{name:'_method', value: 'delete'}]
          url = @get('url')
          $.ajax
            method: 'post'
            url: url
            data: data
            success: @delete_callback
            context: @
        delete_callback : ->
          console.log "it is did"
