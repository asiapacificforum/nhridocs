= message_block

%h1=t('.heading', :firstName => @user.firstName, :lastName => @user.lastName, :app_name => "#{APPLICATION_NAME || 'database'}")

= form_for :user, :url => authengine_activate_path(session[:activation_code]), :method=>:post, :html => {:class => "form-horizontal"} do |f|
  .user_info.form-horizontal
    .form-group
      .col-sm-3.control-label{:for => :login}=t('.select_name')
      .col-sm-4
        = f.text_field :login, :class => 'form-control'
    .form-group
      .col-sm-3.control-label{:for => :email}=t('.your_email')
      .col-sm-4
        = f.text_field :email, :class => 'form-control'
    .form-group
      .col-sm-3.control-label{:for => :password}=t('.select_password')
      .col-sm-4
        = f.password_field :password, :class => 'form-control'
    .form-group
      .col-sm-3.control-label{:for => :password_confirmation}=t('.re_enter')
      .col-sm-4
        = f.password_field :password_confirmation, :class => 'form-control'
    .row
      .col-sm-2
        .btn.btn-default.btn-primary#sign_up{:onclick=>'get_2fa_registration()'}=t('.sign_up')

= javascript_include_tag 'u2f-api.js'

:coffeescript
  $('#user_login').focus()
  @challenge = "#{@user.challenge}"
  @app_id = "#{@app_id}"

  register_callback = (response)->
    console.log "2fa callback: "+JSON.stringify(response)

  opt_timeoutSeconds = 5

  registerRequests = [{version: "U2F_V2" , challenge: challenge, appId: app_id }]

  registeredKeys = []

  @get_2fa_registration = ->
    console.log "register with app_id: "+@app_id+" registerRequests: "+JSON.stringify(registerRequests)
    u2f.register(@appId, registerRequests, registeredKeys, register_callback, opt_timeoutSeconds)
